{"version":3,"file":"index.js","sources":["../../src/context/context-manager.ts"],"sourcesContent":["import { type AppLoadContext, createContext, type RouterContext, type RouterContextProvider } from 'react-router';\nimport type { RequireContextOptions } from './@types/context.types';\n\nconst CONTEXT_REGISTRY = new Map<string, RouterContext<any>>();\n\n/**\n * Create a singleton React Router context that persists across bundled packages\n */\nexport function createContextSingleton<T>(name: string, defaultValue: T): RouterContext<T> {\n  if (CONTEXT_REGISTRY.has(name)) {\n    return CONTEXT_REGISTRY.get(name)!;\n  }\n\n  const context = createContext<T>(defaultValue);\n  (context as any).displayName = name;\n  CONTEXT_REGISTRY.set(name, context);\n\n  return context;\n}\n\n/**\n * Get a context value with optional default fallback\n */\nexport function getContext<T>(context: Readonly<AppLoadContext | RouterContextProvider>, contextKey: RouterContext<T>): T | null;\nexport function getContext<T>(context: Readonly<AppLoadContext | RouterContextProvider>, contextKey: RouterContext<T>, defaultValue: T): T;\nexport function getContext<T>(context: Readonly<AppLoadContext | RouterContextProvider>, contextKey: RouterContext<T>, defaultValue?: T): T | null {\n  // @ts-expect-error - AppLoadContext.get returns unknown which is correct, but we know the type from the context key\n  const value = context.get(contextKey);\n\n  if (value === null || value === undefined) {\n    return defaultValue !== undefined ? defaultValue : null;\n  }\n\n  return value;\n}\n\n/**\n * Require a context value, throwing an error if not found - context MUST be present (e.g., from middleware)\n */\nexport function requireContext<T>(context: Readonly<AppLoadContext | RouterContextProvider>, contextKey: RouterContext<T>, options?: RequireContextOptions): NonNullable<T> {\n  // @ts-expect-error - AppLoadContext.get returns unknown which is correct, but we know the type from the context key\n  const value = context.get(contextKey);\n\n  if (value === null || value === undefined) {\n    const contextName = (contextKey as { displayName?: string }).displayName || 'Unknown';\n    const message = options?.errorMessage || `Required context '${contextName}' not found - middleware may have failed`;\n    const status = options?.errorStatus || 500;\n\n    throw new Response(message, { status, statusText: 'Internal Server Error' });\n  }\n\n  return value as NonNullable<T>;\n}\n\n/**\n * Set a context value in React Router context\n */\nexport function setContext<T>(context: Readonly<RouterContextProvider> | RouterContextProvider, contextKey: RouterContext<T>, value: T): void {\n  (context as RouterContextProvider).set(contextKey, value);\n}\n"],"names":[],"mappings":";AAGA,MAAM,uCAAuB,IAAA;AAKtB,SAAS,uBAA0B,MAAc,cAAmC;AACzF,MAAI,iBAAiB,IAAI,IAAI,GAAG;AAC9B,WAAO,iBAAiB,IAAI,IAAI;AAAA,EAClC;AAEA,QAAM,UAAU,cAAiB,YAAY;AAC5C,UAAgB,cAAc;AAC/B,mBAAiB,IAAI,MAAM,OAAO;AAElC,SAAO;AACT;AAOO,SAAS,WAAc,SAA2D,YAA8B,cAA4B;AAEjJ,QAAM,QAAQ,QAAQ,IAAI,UAAU;AAEpC,MAAI,UAAU,QAAQ,UAAU,QAAW;AACzC,WAAO,iBAAiB,SAAY,eAAe;AAAA,EACrD;AAEA,SAAO;AACT;AAKO,SAAS,eAAkB,SAA2D,YAA8B,SAAiD;AAE1K,QAAM,QAAQ,QAAQ,IAAI,UAAU;AAEpC,MAAI,UAAU,QAAQ,UAAU,QAAW;AACzC,UAAM,cAAe,WAAwC,eAAe;AAC5E,UAAM,UAAU,SAAS,gBAAgB,qBAAqB,WAAW;AACzE,UAAM,SAAS,SAAS,eAAe;AAEvC,UAAM,IAAI,SAAS,SAAS,EAAE,QAAQ,YAAY,yBAAyB;AAAA,EAC7E;AAEA,SAAO;AACT;AAKO,SAAS,WAAc,SAAkE,YAA8B,OAAgB;AAC3I,UAAkC,IAAI,YAAY,KAAK;AAC1D;"}